<ng-container *ngIf="tableEvents$ | async"></ng-container>
<ng-container *ngIf="data$ | async"></ng-container>

<div>
  <div class="flex column">
    <div class="pl-1 pr-1 pt-1">
      <mat-form-field appearance="outline">
        <mat-label i18n>Search {{ entityName }}</mat-label>
        <input
          matInput
          type="search"
          autocomplete="off"
          [formControl]="searchControl"
        />
        <mat-icon matPrefix color="primary">search</mat-icon>
      </mat-form-field>
    </div>

    <mat-toolbar>
      <button
        mat-icon-button
        color="primary"
        [routerLink]="['create']"
        routerLinkActive="router-link-active"
        i18n-matTooltip
        matTooltip="Create"
        matTooltipPosition="below"
      >
        <mat-icon>add</mat-icon>
      </button>
      <button
        mat-icon-button
        color="primary"
        *ngIf="selection.hasValue()"
        (click)="updateItem()"
        i18n-matTooltip
        matTooltip="Update"
        matTooltipPosition="below"
      >
        <mat-icon>edit</mat-icon>
      </button>
      <div class="grow-1"></div>
      <button
        mat-icon-button
        color="accent"
        *ngIf="selection.hasValue()"
        (click)="deleteItem()"
        i18n-matTooltip
        matTooltip="Delete"
        matTooltipPosition="below"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </mat-toolbar>
  </div>
  <table
    mat-table
    [dataSource]="data"
    class="full-width-table"
    matSort
    aria-label="Elements"
    [matSortActive]="active"
    [matSortDirection]="direction"
  >
    <!-- Checkbox Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="$event ? toggleAllRows() : null"
          [checked]="selection.hasValue() && isAllSelected()"
          [indeterminate]="selection.hasValue() && !isAllSelected()"
          [aria-label]="checkboxLabel()"
        >
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="$event ? selection.toggle(row) : null"
          [checked]="selection.isSelected(row)"
          [aria-label]="checkboxLabel(row)"
        >
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- Id Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>#</th>
      <td mat-cell *matCellDef="let row">
        {{ row.id }}
      </td>
    </ng-container>

    <ng-container [matColumnDef]="col.name" *ngFor="let col of visibleColumns">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        <div class="table-th">
          <mat-icon color="primary">{{ col.icon }}</mat-icon>
          <span>{{ col.label }}</span>
        </div>
      </th>
      <td mat-cell *matCellDef="let row">
        {{ col.mapFrom ? col.mapFrom(row[col.name]) : row[col.name] }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns" [@enter]></tr>
  </table>

  <mat-paginator
    #paginator
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [length]="count$ | async"
    [pageSizeOptions]="[2, 5, 10, 20, 30, 40, 50, 100]"
    [showFirstLastButtons]="true"
    aria-label="Select page"
    style="position: sticky; bottom: 0px"
  >
  </mat-paginator>
</div>
